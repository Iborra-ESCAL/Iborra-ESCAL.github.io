<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de preguntas: Prototipado 3D</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Outfit', sans-serif; background-color: #f8fafc; }
        .glass-card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(229, 231, 235, 0.5);
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            height: 250px;
            margin: auto;
        }
        #progress-bar { transition: width 0.3s ease-out; }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .error-item {
            border-left: 4px solid #f43f5e;
            background: #fff1f2;
        }
    </style>
    <!-- 
    Palette Selection: Professional Indigo & Slate
    Primary: #4f46e5 
    Secondary: #06b6d4
    -->
</head>
<body class="text-slate-900 p-2 md:p-8">

    <div id="app" class="max-w-4xl mx-auto">
        <!-- PANTALLA DE INICIO -->
        <div id="start-screen" class="glass-card rounded-3xl p-8 md:p-12 shadow-2xl text-center border-t-8 border-indigo-600 fade-in">
            <div class="text-6xl mb-6 text-indigo-600">‚öôÔ∏è</div>
            <h1 class="text-4xl font-black text-slate-900 mb-4 tracking-tight">Test de preguntas</h1>
            <p class="text-lg text-slate-600 mb-8 leading-relaxed">
                Evaluaci√≥n t√©cnica completa sobre Prototipado R√°pido, Tecnolog√≠as 3D y el Movimiento RepRap.
            </p>
            <div class="bg-indigo-50 rounded-2xl p-6 mb-8 border border-indigo-100 max-w-md mx-auto">
                <div class="flex justify-around text-indigo-900 font-bold">
                    <div class="text-center">
                        <span class="block text-3xl">50</span>
                        <span class="text-xs uppercase opacity-60">Preguntas</span>
                    </div>
                    <div class="w-px bg-indigo-200"></div>
                    <div class="text-center">
                        <span class="block text-3xl">100%</span>
                        <span class="text-xs uppercase opacity-60">Aleatorio</span>
                    </div>
                </div>
            </div>
            <button id="start-btn" onclick="quiz.start()" class="w-full md:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-black py-5 px-16 rounded-2xl shadow-xl transition-all hover:scale-105 active:scale-95 tracking-wide">
                INICIAR TEST
            </button>
        </div>

        <!-- CONTENEDOR DEL TEST -->
        <div id="quiz-container" class="hidden fade-in">
            <div class="flex justify-between items-end mb-4 px-2">
                <div>
                    <span class="text-xs font-black text-indigo-600 uppercase tracking-widest text-indigo-500">Progreso del Test</span>
                    <h3 class="text-xl font-bold text-slate-800" id="progress-text">Pregunta 1 de 50</h3>
                </div>
                <div class="text-right">
                    <span id="score-live" class="bg-indigo-100 text-indigo-700 px-4 py-1 rounded-full text-sm font-bold shadow-sm">Puntos: 0</span>
                </div>
            </div>
            <div class="w-full bg-slate-200 rounded-full h-3 mb-8 overflow-hidden">
                <div id="progress-bar" class="bg-indigo-600 h-full" style="width: 2%"></div>
            </div>

            <div class="glass-card rounded-3xl p-6 md:p-10 shadow-xl min-h-[500px] flex flex-col justify-between">
                <div id="question-area">
                    <h2 id="question-title" class="text-2xl font-extrabold text-slate-800 mb-8 leading-tight"></h2>
                    <div id="options-grid" class="grid grid-cols-1 gap-4"></div>
                </div>
                <div class="mt-10 flex flex-col md:flex-row justify-between items-center gap-4 border-t border-slate-100 pt-6">
                    <p class="text-slate-400 text-xs italic">Selecciona una respuesta para continuar</p>
                    <button id="next-btn" onclick="quiz.next()" disabled class="w-full md:w-auto bg-slate-300 text-white font-black py-4 px-12 rounded-2xl cursor-not-allowed transition-all shadow-lg">
                        SIGUIENTE
                    </button>
                </div>
            </div>
        </div>

        <!-- PANTALLA DE RESULTADOS -->
        <div id="results-screen" class="hidden fade-in space-y-8">
            <div class="glass-card rounded-3xl p-8 md:p-12 shadow-2xl border-t-8 border-indigo-600 text-center">
                <div class="text-5xl mb-4">üèÜ</div>
                <h2 class="text-4xl font-black text-slate-900 mb-2">¬°Test Finalizado!</h2>
                <div id="final-score" class="text-7xl font-black text-indigo-600 mb-6">0 / 50</div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center text-left">
                    <div class="chart-container">
                        <canvas id="resultsChart"></canvas>
                    </div>
                    <div class="bg-slate-50 p-6 rounded-2xl border border-slate-200">
                        <h3 class="text-xl font-bold text-indigo-900 mb-4">An√°lisis de resultados</h3>
                        <div id="performance-summary" class="space-y-3"></div>
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-10">
                    <button onclick="quiz.copyResults()" class="bg-slate-800 hover:bg-slate-900 text-white font-bold py-4 px-6 rounded-xl flex items-center justify-center gap-2 transition-all">
                        <span>üìã</span> Copiar Resultados
                    </button>
                    <button onclick="quiz.sendEmail()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-6 rounded-xl flex items-center justify-center gap-2 transition-all">
                        <span>üìß</span> Enviar por Correo
                    </button>
                    <button onclick="window.location.reload()" class="bg-white hover:bg-slate-50 text-slate-600 font-bold py-4 px-6 rounded-xl border-2 border-slate-200 transition-all">
                        <span>üîÑ</span> Reiniciar
                    </button>
                </div>
            </div>

            <!-- LISTADO DE ERRORES -->
            <div id="error-section" class="hidden fade-in bg-white rounded-3xl p-6 md:p-10 shadow-xl border border-slate-200">
                <div class="flex items-center gap-3 mb-6">
                    <div class="h-8 w-2 bg-rose-500 rounded-full"></div>
                    <h3 class="text-2xl font-black text-slate-800">Revisi√≥n de respuestas incorrectas</h3>
                </div>
                <div id="error-list" class="space-y-4">
                    <!-- Se carga din√°micamente -->
                </div>
            </div>
        </div>
    </div>

    <!-- Buffer invisible para copiado -->
    <textarea id="copy-buffer" class="fixed -top-full left-0 opacity-0 pointer-events-none"></textarea>

    <script>
        // Banco de preguntas con respuestas barajadas (c es el √≠ndice de la opci√≥n correcta)
        const quizData = [
            { q: "¬øQu√© tecnolog√≠a utiliza un l√°ser para fusionar polvo pl√°stico?", a: ["SLS", "FDM", "SLA", "LOM"], c: 0 },
            { q: "¬øCu√°l es el formato de archivo universal para impresi√≥n 3D?", a: ["GCODE", "CAD", "STL", "OBJ"], c: 2 },
            { q: "La Estereolitograf√≠a (SLA) solidifica material mediante...", a: ["Presi√≥n", "Luz UV", "Calor", "Corte"], c: 1 },
            { q: "¬øQu√© diferencia al FFF del FDM?", a: ["FFF usa metal", "La tecnolog√≠a es distinta", "No hay diferencia t√©cnica", "FDM es marca registrada, FFF es el t√©rmino libre"], c: 3 },
            { q: "¬øQu√© t√©cnica usa capas de papel o pl√°stico cortado?", a: ["LOM", "SLS", "Aglomeraci√≥n", "FDM"], c: 0 },
            { q: "La aglomeraci√≥n por inyecci√≥n se basa en...", a: ["Fundir filamento", "Curas con l√°ser", "Pegar polvo con adhesivo l√≠quido", "Laminado manual"], c: 2 },
            { q: "¬øEn qu√© a√±o fund√≥ Adrian Bowyer el proyecto RepRap?", a: ["2000", "2010", "2005", "2015"], c: 2 },
            { q: "¬øCu√°l es la caracter√≠stica principal de una RepRap?", a: ["Es muy cara", "Puede imprimir sus propias piezas", "Solo usa Arduino Uno", "No usa software"], c: 1 },
            { q: "Arduino es fundamental en la impresi√≥n 3D hobby por ser...", a: ["Un software de dise√±o", "Hardware cerrado", "Hardware de c√≥digo abierto", "Una marca de filamento"], c: 2 },
            { q: "¬øC√≥mo se llama la pieza que calienta y funde el filamento?", a: ["Cama caliente", "Hotend (Extrusor)", "Ventilador", "Bobina"], c: 1 },
            { q: "El primer paso tras tener una idea es...", a: ["Imprimir", "Dise√±o CAD u obtenci√≥n del objeto", "Comprar filamento", "Laminar"], c: 1 },
            { q: "¬øQu√© repositorio es famoso por compartir dise√±os 3D?", a: ["Thingiverse", "Spotify", "Wikipedia", "Instagram"], c: 0 },
            { q: "Software como Fusion 360 o Solidworks son de tipo...", a: ["CAD", "Slicer", "Firmware", "Reparador"], c: 0 },
            { q: "Netfabb se utiliza principalmente para...", a: ["Dibujar", "Generar GCode", "Reparar mallas y comprobar orientaci√≥n", "Vender dise√±os"], c: 2 },
            { q: "¬øQu√© es el Slicing (laminado)?", a: ["Convertir el 3D en capas y GCode", "Limpiar la boquilla", "Pintar la pieza", "Unir piezas"], c: 0 },
            { q: "Slic3r es el predecesor directo de...", a: ["Cura", "Simplify3D", "Blender", "PrusaSlicer"], c: 3 },
            { q: "¬øQu√© material es biodegradable y f√°cil de imprimir?", a: ["ABS", "Nylon", "Policarbonato", "PLA"], c: 3 },
            { q: "¬øQu√© requiere el ABS para evitar el warping?", a: ["Ventilador al 100%", "Luz UV", "Cama caliente y ambiente estable", "Corte por l√°ser"], c: 2 },
            { q: "La altura de capa influye directamente en...", a: ["El color", "El peso del motor", "La resoluci√≥n vertical y tiempo", "La marca de la impresora"], c: 2 },
            { q: "¬øQu√© es el 'Flow' o flujo?", a: ["La cantidad de material extruido", "La velocidad de los ventiladores", "La temperatura ambiente", "El dise√±o de la base"], c: 0 },
            { q: "La Ender 3 es una impresora de estructura...", a: ["Delta", "Cartesiana", "Polar", "SCARA"], c: 1 },
            { q: "La Ender 3 Neo incluye de serie...", a: ["Grabador l√°ser", "Nivelaci√≥n autom√°tica CR-Touch", "C√°mara wifi", "Secador de filamento"], c: 1 },
            { q: "La Wasp Delta 2040 es conocida por su arquitectura...", a: ["Delta de alta velocidad", "C√∫bica", "Resina", "Papel"], c: 0 },
            { q: "¬øQu√© significa que una malla no sea 'Manifold'?", a: ["Que es muy bonita", "Que tiene agujeros o errores geom√©tricos", "Que es de color rojo", "Que es muy grande"], c: 1 },
            { q: "El GCode es un lenguaje de...", a: ["Instrucciones num√©ricas para m√°quinas", "Programaci√≥n visual", "Dise√±o art√≠stico", "Base de datos"], c: 0 },
            { q: "¬øQu√© par√°metro controla la densidad interna de la pieza?", a: ["Shells", "Brim", "Skirt", "Infill (Relleno)"], c: 3 },
            { q: "El 'Brim' sirve para...", a: ["Mejorar la adhesi√≥n a la cama", "Ahorrar material", "Enfriar la boquilla", "Limpiar la pieza"], c: 0 },
            { q: "¬øQu√© sucede si la temperatura del extrusor es muy baja?", a: ["Se quema el pl√°stico", "La impresi√≥n va m√°s r√°pido", "Atascos y mala adhesi√≥n", "No influye"], c: 2 },
            { q: "El filamento PLA se fabrica a partir de...", a: ["Petr√≥leo", "Arena", "Madera reciclada", "Almid√≥n de ma√≠z o ca√±a de az√∫car"], c: 3 },
            { q: "¬øQu√© es la 'Retracci√≥n'?", a: ["El movimiento del eje Z", "El retroceso del filamento para evitar hilos", "Apagar la impresora", "Limpiar la cama"], c: 1 },
            { q: "En un laminador, el 'Infill' del 100% significa...", a: ["Pieza hueca", "Pieza transparente", "Pieza totalmente s√≥lida", "Error de lectura"], c: 2 },
            { q: "¬øCu√°l es el componente que calienta el filamento?", a: ["El motor", "La pantalla", "La fuente", "El Hotend"], c: 3 },
            { q: "Las impresoras Delta se mueven mediante...", a: ["Tres brazos articulados", "Dos correas cruzadas", "Un solo motor central", "Ruedas de goma"], c: 0 },
            { q: "¬øPara qu√© sirve el ventilador de capa?", a: ["Enfriar los motores", "Enfriar el pl√°stico reci√©n depositado", "Limpiar el polvo", "Decoraci√≥n"], c: 1 },
            { q: "¬øQu√© es el 'Overhang'?", a: ["Una pieza muy peque√±a", "Un tipo de filamento", "Un voladizo o parte que cuelga", "El cable de datos"], c: 2 },
            { q: "Los 'Soportes' son necesarios cuando...", a: ["Hay √°ngulos pronunciados al aire", "La pieza es plana", "Usamos mucho relleno", "La cama est√° fr√≠a"], c: 0 },
            { q: "La licencia de RepRap es generalmente...", a: ["GPL (Software/Hardware Libre)", "Propiedad de Microsoft", "Privada", "Solo para universidades"], c: 0 },
            { q: "¬øQu√© material emite olor a pl√°stico quemado fuerte (estireno)?", a: ["PLA", "ABS", "PETG", "Madera"], c: 1 },
            { q: "Blender se diferencia de Solidworks por ser...", a: ["M√°s caro", "Modelado org√°nico y art√≠stico", "Solo para ingenieros", "No exporta STL"], c: 1 },
            { q: "Un archivo STL representa la superficie mediante...", a: ["P√≠xeles", "Ecuaciones", "Tri√°ngulos (teselaci√≥n)", "Nubes de puntos"], c: 2 },
            { q: "La velocidad de impresi√≥n t√≠pica suele estar entre...", a: ["40-80 mm/s", "5-10 mm/s", "500-1000 mm/s", "1-2 mm/s"], c: 0 },
            { q: "¬øQu√© es el 'Z-Offset'?", a: ["El ancho de la pieza", "El nombre de la impresora", "La distancia entre boquilla y cama", "La velocidad del ventilador"], c: 2 },
            { q: "El proyecto RepRap busca la democratizaci√≥n de la...", a: ["Fabricaci√≥n personal", "M√∫sica", "Agricultura", "Energ√≠a"], c: 0 },
            { q: "Marlin es un ejemplo de...", a: ["Dise√±o CAD", "Marca de filamento", "Firmware para impresoras 3D", "Laminador"], c: 2 },
            { q: "¬øQu√© eje controla el movimiento horizontal lateral?", a: ["Eje X", "Eje Y", "Eje Z", "Eje E"], c: 0 },
            { q: "La 'Cama caliente' es opcional en materiales como...", a: ["ABS", "PLA", "Nylon", "Policarbonato"], c: 1 },
            { q: "TraceParts es un portal de...", a: ["Noticias", "Venta de impresoras", "Modelos CAD t√©cnicos y piezas est√°ndar", "Chat de usuarios"], c: 2 },
            { q: "El 'Skirt' (falda) sirve para...", a: ["Sujetar la pieza", "Purgar el extrusor antes de empezar", "Decorar", "Aislar del calor"], c: 1 },
            { q: "¬øQu√© significa que una impresora sea 'Open Source'?", a: ["Que sus planos y c√≥digos son p√∫blicos", "Que es gratis", "Que no tiene cables", "Que se compra en l√≠nea"], c: 0 },
            { q: "¬øEs la impresi√≥n 3D una tecnolog√≠a aditiva?", a: ["No, es sustractiva", "Es solo para prototipos de papel", "S√≠, a√±ade material capa a capa", "Ya no se usa"], c: 2 }
        ];

        let currentQuestion = 0;
        let score = 0;
        let selectedOption = null;
        let chartInstance = null;
        let errors = [];

        const quiz = {
            start() {
                document.getElementById('start-screen').classList.add('hidden');
                document.getElementById('quiz-container').classList.remove('hidden');
                this.renderQuestion();
            },
            renderQuestion() {
                const q = quizData[currentQuestion];
                document.getElementById('question-title').innerText = q.q;
                document.getElementById('progress-text').innerText = `Pregunta ${currentQuestion + 1} de 50`;
                document.getElementById('progress-bar').style.width = `${((currentQuestion + 1) / 50) * 100}%`;
                
                const grid = document.getElementById('options-grid');
                grid.innerHTML = '';
                
                q.a.forEach((opt, idx) => {
                    const btn = document.createElement('button');
                    btn.className = "option-btn w-full text-left p-5 rounded-2xl border-2 border-slate-100 hover:border-indigo-200 hover:bg-indigo-50 transition-all font-semibold flex items-center gap-4 bg-white";
                    btn.innerHTML = `<span class="h-10 w-10 shrink-0 rounded-xl bg-slate-100 flex items-center justify-center text-sm font-black text-slate-500 border border-slate-200">${String.fromCharCode(65 + idx)}</span> <span class="text-slate-700">${opt}</span>`;
                    btn.onclick = () => this.selectOption(idx, btn);
                    grid.appendChild(btn);
                });
                
                const nextBtn = document.getElementById('next-btn');
                nextBtn.disabled = true;
                nextBtn.className = "w-full md:w-auto bg-slate-300 text-white font-black py-4 px-12 rounded-2xl cursor-not-allowed transition-all shadow-lg";
                nextBtn.innerText = currentQuestion === 49 ? "FINALIZAR TEST" : "SIGUIENTE PREGUNTA";
            },
            selectOption(idx, btn) {
                selectedOption = idx;
                document.querySelectorAll('.option-btn').forEach(b => {
                    b.classList.remove('border-indigo-600', 'bg-indigo-50', 'ring-4', 'ring-indigo-100');
                    b.classList.add('border-slate-100', 'bg-white');
                });
                
                btn.classList.remove('border-slate-100', 'bg-white');
                btn.classList.add('border-indigo-600', 'bg-indigo-50', 'ring-4', 'ring-indigo-100');
                
                const nextBtn = document.getElementById('next-btn');
                nextBtn.disabled = false;
                nextBtn.className = "w-full md:w-auto bg-indigo-600 text-white font-black py-4 px-12 rounded-2xl cursor-pointer transition-all shadow-lg hover:bg-indigo-700 active:scale-95";
            },
            next() {
                const correctIdx = quizData[currentQuestion].c;
                if (selectedOption === correctIdx) {
                    score++;
                } else {
                    errors.push({
                        q: quizData[currentQuestion].q,
                        correct: quizData[currentQuestion].a[correctIdx]
                    });
                }
                
                document.getElementById('score-live').innerText = `Puntos: ${score}`;
                
                currentQuestion++;
                if (currentQuestion < quizData.length) {
                    selectedOption = null;
                    this.renderQuestion();
                } else {
                    this.showResults();
                }
            },
            showResults() {
                document.getElementById('quiz-container').classList.add('hidden');
                document.getElementById('results-screen').classList.remove('hidden');
                document.getElementById('final-score').innerText = `${score} / 50`;
                
                const percentage = (score / 50) * 100;
                let feedback = percentage >= 90 ? "Nivel Experto" : percentage >= 70 ? "Nivel Avanzado" : percentage >= 50 ? "Nivel T√©cnico" : "Principiante";
                let colorClass = percentage >= 50 ? "text-emerald-600" : "text-rose-600";

                document.getElementById('performance-summary').innerHTML = `
                    <div class="flex justify-between items-center py-2 border-b border-slate-200">
                        <span class="font-bold text-slate-500">Valoraci√≥n:</span>
                        <span class="font-black ${colorClass}">${feedback}</span>
                    </div>
                    <div class="flex justify-between items-center py-2 border-b border-slate-200">
                        <span class="font-bold text-slate-500">Porcentaje:</span>
                        <span class="font-black text-slate-800">${percentage}%</span>
                    </div>
                    <div class="flex justify-between items-center py-2">
                        <span class="font-bold text-slate-500">Puntos:</span>
                        <span class="font-black text-indigo-600">${score} de 50</span>
                    </div>
                `;

                if (errors.length > 0) {
                    document.getElementById('error-section').classList.remove('hidden');
                    const errorList = document.getElementById('error-list');
                    errorList.innerHTML = '';
                    errors.forEach(err => {
                        const div = document.createElement('div');
                        div.className = "error-item p-4 rounded-xl shadow-sm fade-in";
                        div.innerHTML = `
                            <p class="text-slate-800 font-bold mb-2">${err.q}</p>
                            <p class="text-emerald-700 text-sm font-semibold">Respuesta correcta: ${err.correct}</p>
                        `;
                        errorList.appendChild(div);
                    });
                }

                this.renderChart();
            },
            renderChart() {
                const ctx = document.getElementById('resultsChart').getContext('2d');
                if(chartInstance) chartInstance.destroy();
                
                chartInstance = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: wrapLabels(['Aciertos', 'Errores']),
                        datasets: [{
                            data: [score, 50 - score],
                            backgroundColor: ['#4f46e5', '#e2e8f0'],
                            borderWidth: 0,
                            borderRadius: 10
                        }]
                    },
                    options: {
                        cutout: '70%',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    title: function(items) {
                                        let label = items[0].chart.data.labels[items[0].dataIndex];
                                        if (Array.isArray(label)) return label.join(' ');
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            },
            copyResults() {
                const text = `Resultados del Test de Impresi√≥n 3D:\nPuntuaci√≥n: ${score} de 50 (${(score/50)*100}%).\nErrores cometidos: ${errors.length}.`;
                const buffer = document.getElementById('copy-buffer');
                buffer.value = text;
                buffer.select();
                document.execCommand('copy');
                
                const btn = event.currentTarget;
                const original = btn.innerHTML;
                btn.innerHTML = '<span>‚úÖ</span> ¬°Copiado!';
                setTimeout(() => btn.innerHTML = original, 2000);
            },
            sendEmail() {
                const subject = encodeURIComponent("Resultados Test de Prototipado 3D");
                const body = encodeURIComponent(`He completado el test t√©cnico.\n\nResultado Final: ${score} de 50 puntos (${(score/50)*100}%).\n\nEnviado desde mi informe interactivo.`);
                window.location.href = `mailto:?subject=${subject}&body=${body}`;
            }
        };

        function wrapLabels(labels) {
            return labels.map(label => {
                if (label.length > 16) {
                    const words = label.split(' ');
                    const lines = [];
                    let current = "";
                    words.forEach(w => {
                        if ((current + w).length > 16) {
                            lines.push(current.trim());
                            current = w + " ";
                        } else {
                            current += w + " ";
                        }
                    });
                    lines.push(current.trim());
                    return lines;
                }
                return label;
            });
        }
    </script>
</body>
</html>